// Generated by CoffeeScript 1.6.3
(function(){var e,t,n;n=require("bcrypt");t=require("../lib/auth");e=require("../models/users.js");exports.login=function(e,n){t.ssl_required(e,n,!0);n.render("auth/login",{locals:{title:"Login",flash:e.flash()}})};exports.authenticate=function(r,i){var s,o;t.ssl_required(r,i,!0);o=r.body.username;s=r.body.password;e.findOne({username:o},function(e,t){if(e){r.flash("error","Invalid username / password combination.");i.redirect("/auth/login");return}if(!t){r.flash("error","Invalid username / password combination.");i.redirect("/auth/login");return}n.compare(s,t.password,function(e,n){if(e){r.flash("error","An error occurred.");i.redirect("/auth/login");return}if(!n){r.flash("error","Invalid username / password combination.");i.redirect("/auth/login");return}r.flash("error","Welcome, "+t.fullname+".");r.session.auth=!0;r.session.username=o;i.locals.authenticated=!0;i.locals.username=o;i.redirect("/content/menu");return})})};exports.logout=function(e,t){e.session.regenerate(function(){t.redirect("/auth/login")})}}).call(this);